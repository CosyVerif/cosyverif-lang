language: php
php:
  - 5.3

cache: true

services:
 - redis

before_install:
  - sudo apt-get update     -y
  - sudo apt-get autoremove -y
  - sudo apt-get install -y git make gcc diffutils patch wget unzip
  - sudo apt-get install -y libev-dev libssl-dev
  - sudo apt-get install -y nginx-extras imagemagick
  - ./bin/install --prefix=$HOME --sourcepath=$(pwd)

before_script:
  - rm    -rf shippable/testresults
  - mkdir -p  shippable/testresults
  - rm    -rf output
  - mkdir -p  output

script:
  - ${HOME}/bin/cosy-check output --test-format=junit

after_script:
  - mv output/test-*    shippable/testresults
  - for file in shippable/testresults/*; do; mv ${file} ${file}.xml; done
  - mv output/coverage  shippable/coverage
  - mv luacov.*         shippable/

notifications:
  email:
    recipients:
      - alban@linard.fr
      - leprieur@lipn.univ-paris13.fr
    on_success: change
    on_failure: always
